<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>จัดจำแนก: สารละลาย • คอลลอยด์ • สารแขวนลอย (40 ข้อ) | แดงแรงฤทธิ์ | 200 วิ</title>
<style>
  :root{
    --bg:#fff7f7; --card:#ffffff; --ink:#1f2937;
    --brand:#dc2626; /* แดงสด */
    --good:#059669; --bad:#b91c1c; --muted:#6b7280;
    --ring:0 8px 30px rgba(220,38,38,.18);
    --btn:#fff1f2; --btnBorder:#fecaca; --btnActive:#fecaca;
    --timer:#ef4444; --timerDanger:#7f1d1d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:"Noto Sans Thai",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
  .wrap{max-width:1040px;margin:0 auto;padding:24px}
  .card{background:var(--card);border-radius:20px;box-shadow:var(--ring);padding:20px;border:1px solid #fee2e2}
  h1{margin:8px 0 4px;font-size:clamp(22px,3.6vw,34px)}
  .brand{font-weight:800;color:var(--brand)}
  .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:#ffe4e6;color:#9f1239;font-weight:700;font-size:14px}
  .sub{color:var(--muted)}
  .start{display:grid;gap:16px;max-width:560px;margin:12px auto}
  input[type="text"]{width:100%;padding:14px 16px;border-radius:14px;border:1px solid #fecaca;font-size:18px;outline:none;background:#fffaf9}
  input[type="text"]:focus{border-color:var(--brand);box-shadow:0 0 0 4px rgba(220,38,38,.15)}
  button{appearance:none;border:0;background:var(--brand);color:#fff;font-weight:700;
    padding:14px 18px;border-radius:14px;cursor:pointer;font-size:18px;box-shadow:var(--ring)}
  button.secondary{background:#ef4444}
  button.ghost{background:#ffe4e6;color:#7f1d1d}
  .kru{margin-top:18px;font-weight:800;letter-spacing:.3px;color:#7f1d1d}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .result{margin-top:16px;padding:12px;border-radius:14px;background:#fff1f2;border:1px solid #fecaca;display:none}
  .ok{color:var(--good);font-weight:800}
  .ng{color:var(--bad);font-weight:800}
  .tiny{font-size:13px;color:var(--muted)}
  .tick{font-weight:800;margin-left:10px}
  .tick.hidden{visibility:hidden}
  /* Question row */
  .qrow{display:grid;gap:12px;align-items:center;grid-template-columns:1fr minmax(260px,420px);
    background:#fff; border:1px solid #ffe4e6; border-radius:14px; padding:12px}
  @media (max-width:780px){.qrow{grid-template-columns:1fr}}
  .qtext{font-size:16px}
  .opts{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .btnopt{display:flex;justify-content:center;align-items:center;gap:6px;
    padding:10px 12px;border-radius:12px;border:1px solid var(--btnBorder);
    background:var(--btn);color:#7f1d1d;font-size:15px;cursor:pointer;user-select:none}
  .btnopt.selected{background:var(--btnActive);border-color:#fb7185}
  .answers{margin-top:10px;display:none}
  .answers .a{padding:8px 10px;border-radius:10px;background:#fff;border:1px dashed #fecaca;margin-top:6px}
  .pass{color:#065f46;font-weight:900}
  .fail{color:#b91c1c;font-weight:900}

  /* Timer bar */
  .timerWrap{margin:10px 0 14px}
  .timerBar{height:12px;background:#ffe4e6;border-radius:999px;overflow:hidden;border:1px solid #fecaca}
  .timerFill{height:100%;width:100%;background:var(--timer);transition:width .5s linear}
  .timerRow{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .timeText{font-weight:800;color:#7f1d1d}

  /* Time-up banner */
  #timeUpBanner{display:none; position:fixed; inset:0; background:rgba(0,0,0,.5); z-index:9999;
    align-items:center; justify-content:center; padding:20px;}
  #timeUpBanner .box{background:#fff; border-radius:18px; padding:20px; max-width:520px; width:100%;
    box-shadow:0 20px 60px rgba(0,0,0,.25); text-align:center;}
  #timeUpBanner h3{margin:0 0 8px; font-size:24px; color:#b91c1c}
  #timeUpBanner p{margin:0 0 12px; color:#374151}
</style>
</head>
<body>
  <div class="wrap">
    <div id="screen-start" class="card">
      <div class="badge">Kru Pai Classroom</div>
      <h1>เกมจำแนกชนิด <span class="brand">สารละลาย • คอลลอยด์ • สารแขวนลอย</span></h1>
      <div class="sub">มี 40 ข้อ — เลือกประเภทให้ถูกต้องภายใน <b>200 วินาที</b> (ข้อละ ~5 วิ) แล้วค่อยเฉลยทีเดียว • สุ่มลำดับทุกครั้ง</div>
      <div class="start">
        <label>ชื่อนักเรียน</label>
        <input id="player" type="text" placeholder="พิมพ์ชื่อเล่น..." />
        <button id="startBtn">เริ่มเกม</button>
      </div>
    </div>

    <div id="screen-game" class="card" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div class="badge">Kru Pai Classroom</div>
        <div class="kru" id="who"></div>
      </div>

      <div class="timerWrap">
        <div class="timerRow">
          <div class="timeText">เวลาเหลือ: <span id="timeLeft">03:20</span></div>
          <div class="tiny">ครบ 200 วิจะตรวจให้อัตโนมัติ</div>
        </div>
        <div class="timerBar"><div id="timerFill" class="timerFill"></div></div>
      </div>

      <h2 style="margin:10px 0 8px">แบบฝึก: เลือกประเภท (40 ข้อ)</h2>
      <div id="qwrap" class="grid" style="display:grid;gap:12px"></div>

      <div class="actions">
        <button id="checkBtn">ตรวจคำตอบ</button>
        <button class="secondary" id="resetBtn">ล้างคำตอบ</button>
        <button class="ghost" id="backBtn">กลับหน้าแรก</button>
      </div>

      <div id="result" class="result"></div>

      <div class="actions" id="afterActions" style="display:none">
        <button class="secondary" id="toggleAns">ดูเฉลย</button>
        <button class="ghost" id="againBtn">ทำใหม่</button>
      </div>

      <div id="answers" class="answers"></div>
    </div>
  </div>

  <!-- Time-up modal -->
  <div id="timeUpBanner">
    <div class="box">
      <h3>⏰ หมดเวลาแล้ว!</h3>
      <p>ระบบตรวจคำตอบให้อัตโนมัติ และล็อกการเลือกคำตอบ</p>
      <button id="viewResultBtn">ดูผลลัพธ์</button>
    </div>
  </div>

<script>
const TOTAL_SECONDS = 200; // 40 x 5 วิ
let secondsLeft = TOTAL_SECONDS;
let timerId = null;

// 3 categories
const TYPES = {
  solution: "สารละลาย",
  colloid: "คอลลอยด์",
  suspension: "สารแขวนลอย"
};

// 40 items (สุ่มภายหลัง): เพิ่มตัวอย่างคอลลอยด์ตามที่ขอ และแขวนลอยแบบอาหารขำ ๆ
let items = [
  // สารละลาย
  {name:"น้ำเกลือใส", type:"solution", explain:"เกลือละลายในน้ำอย่างเป็นเนื้อเดียว"},
  {name:"น้ำตาลละลายน้ำ", type:"solution", explain:"ตัวถูกละลาย (น้ำตาล) กระจายตัวสม่ำเสมอ"},
  {name:"น้ำส้มสายชู", type:"solution", explain:"กรดอะซิติกเจือจางในน้ำ"},
  {name:"น้ำอัดลมใส", type:"solution", explain:"CO₂ ละลายในน้ำ (ก๊าซในของเหลว)"},
  {name:"เอทานอลผสมน้ำ", type:"solution", explain:"ของเหลวผสมเป็นเนื้อเดียว"},
  {name:"อากาศบริสุทธิ์", type:"solution", explain:"ส่วนผสมเนื้อเดียวของก๊าซหลายชนิด"},
  {name:"น้ำเชื่อมใส", type:"solution", explain:"น้ำตาลละลายเป็นเนื้อเดียว"},
  {name:"น้ำทะเลใส", type:"solution", explain:"เกลือละลายในน้ำเป็นเนื้อเดียว"},
  {name:"ด่างทับทิมเจือจาง", type:"solution", explain:"เกลือละลายในน้ำ"},
  {name:"ทองเหลือง (อัลลอย)", type:"solution", explain:"สารละลายของแข็ง (ทองแดง+สังกะสี)"},
  {name:"น้ำชาใส", type:"solution", explain:"สารรส/กลิ่นละลายในน้ำ"},
  {name:"น้ำยาบ้วนปากใส", type:"solution", explain:"สารออกฤทธิ์ละลายในน้ำ"},
  {name:"หมึกสีย้อมใส (dye-based)", type:"solution", explain:"สีย้อมละลายในตัวทำละลาย"},
  {name:"เกลือแร่ละลายน้ำใส", type:"solution", explain:"ไอออนละลายในน้ำ"},
  {name:"น้ำแอปเปิลใส (กรองพิเศษ)", type:"solution", explain:"กรองเอาคอลลอยด์ออก เหลือสารละลาย"},
  // คอลลอยด์ (ตามที่ขอ)
  {name:"นม", type:"colloid", explain:"อีมัลชันของไขมันในน้ำ"},
  {name:"น้ำกะทิ", type:"colloid", explain:"อีมัลชันของน้ำมันมะพร้าวในน้ำ"},
  {name:"เมฆ/หมอก", type:"colloid", explain:"หยดน้ำเล็ก ๆ ลอยในอากาศ"},
  {name:"น้ำสลัด", type:"colloid", explain:"อีมัลชันน้ำมันกับน้ำ/น้ำส้มสายชู"},
  {name:"เยลลี่", type:"colloid", explain:"เจลของโพลิเมอร์กักเก็บน้ำ"},
  {name:"ไอศกรีม", type:"colloid", explain:"โฟม/อีมัลชันแช่แข็ง"},
  {name:"ครีมโกนหนวด", type:"colloid", explain:"โฟม (ก๊าซในของเหลว)"},
  {name:"ฟองสบู่", type:"colloid", explain:"ฟิล์มของเหลวหุ้มก๊าซ"},
  {name:"แป้งข้าวโพดในน้ำ (เหนียว)", type:"colloid", explain:"โซล/คอลลอยด์ ขึ้นกับสัดส่วน"},
  {name:"โลชั่น", type:"colloid", explain:"อีมัลชันน้ำ/น้ำมัน"},
  // แขวนลอย (อาหารขำ ๆ ตามคำขอ)
  {name:"ข้าวมันไก่ (ราดน้ำซุป)", type:"suspension", explain:"ของแข็งหลายชิ้นในของเหลว — เนื้อไม่เป็นเนื้อเดียว"},
  {name:"ก๋วยเตี๋ยวน้ำ", type:"suspension", explain:"เส้น/ผัก/เนื้อ แขวนลอยในน้ำซุป"},
  {name:"ชานมไข่มุก", type:"suspension", explain:"เม็ดไข่มุกเป็นของแข็งแขวนลอยในของเหลว"},
  {name:"น้ำโคลน", type:"suspension", explain:"ดิน/โคลนแขวนลอย ตกตะกอนได้"},
  {name:"ทรายในน้ำ", type:"suspension", explain:"เม็ดทรายใหญ่ ตกตะกอนได้"},
  {name:"ผงชอล์กในน้ำ", type:"suspension", explain:"อนุภาคใหญ่ กรองได้"},
  {name:"ผงถ่านในน้ำ", type:"suspension", explain:"อนุภาคใหญ่/รวมกลุ่ม ตกตะกอน"},
  {name:"น้ำดินหลังฝนตก", type:"suspension", explain:"ฝุ่นดินแขวนลอย"},
  {name:"โกโก้ผงในนมเย็น (ยังไม่ละลาย)", type:"suspension", explain:"เกาะกลุ่มแขวนลอย กรองได้"},
  {name:"ผงยีสต์ในน้ำ", type:"suspension", explain:"เซลล์ยีสต์แขวนลอย ตกตะกอนได้"}
];

const $ = s=>document.querySelector(s);
const qwrap = $('#qwrap');
const resultEl = $('#result');
const answersEl = $('#answers');
const timeLeftEl = $('#timeLeft');
const timerFillEl = $('#timerFill');
const banner = document.getElementById('timeUpBanner');
const viewResultBtn = document.getElementById('viewResultBtn');

/* Fisher–Yates shuffle */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* selections */
const selected = {}; // {index: 'solution'|'colloid'|'suspension'}

/* Render questions after shuffle */
function renderQuestions(){
  qwrap.innerHTML = "";
  const shuffled = shuffle(items.slice());
  shuffled.forEach((it, idx)=>{
    const i = idx+1;
    const row = document.createElement('div');
    row.className = 'qrow';
    row.dataset.index = i;
    row.innerHTML = `
      <div class="qtext">${i}. ${it.name} <span id="tick-${i}" class="tick hidden">✓</span></div>
      <div class="opts" id="opts-${i}">
        <button type="button" class="btnopt" data-val="solution">สารละลาย</button>
        <button type="button" class="btnopt" data-val="colloid">คอลลอยด์</button>
        <button type="button" class="btnopt" data-val="suspension">สารแขวนลอย</button>
      </div>
    `;
    qwrap.appendChild(row);
    // keep the true type on DOM for grading
    row.dataset.trueType = it.type;
    row.dataset.name = it.name;
    row.dataset.explain = it.explain;

    row.querySelectorAll('.btnopt').forEach(btn=>{
      btn.addEventListener('click', ()=>select(i, btn.dataset.val, btn));
    });
  });
}

function select(i, val, btn){
  document.querySelectorAll(`#opts-${i} .btnopt`).forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  selected[i] = val;
}

/* Timer helpers */
function fmt(sec){
  const m = Math.floor(sec/60).toString().padStart(1,'0');
  const s = Math.floor(sec%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}
function updateTimerUI(){
  timeLeftEl.textContent = fmt(secondsLeft);
  const pct = Math.max(0, (secondsLeft / TOTAL_SECONDS) * 100);
  timerFillEl.style.width = pct + '%';
  if(secondsLeft <= 20){ timerFillEl.style.background = 'var(--timerDanger)'; }
}

/* buttons */
document.getElementById('startBtn').addEventListener('click', ()=>{
  const name = document.getElementById('player').value.trim() || 'นักเรียน';
  document.getElementById('who').textContent = `ผู้เล่น: ${name}`;
  document.getElementById('screen-start').style.display='none';
  document.getElementById('screen-game').style.display='block';
  window.scrollTo({top:0, behavior:'smooth'});

  renderQuestions(); // สุ่มก่อนทุกครั้ง

  // start timer
  secondsLeft = TOTAL_SECONDS;
  updateTimerUI();
  timerId = setInterval(()=>{
    secondsLeft--;
    updateTimerUI();
    if(secondsLeft <= 0){
      clearInterval(timerId);
      autoSubmit();
    }
  }, 1000);
});

document.getElementById('backBtn').addEventListener('click', ()=>location.reload());

document.getElementById('resetBtn').addEventListener('click', ()=>{
  Object.keys(selected).forEach(k=>delete selected[k]);
  renderQuestions(); // สุ่มใหม่ด้วย
  document.querySelectorAll('.tick').forEach(t=>{ t.classList.add('hidden'); t.textContent='✓'; t.style.color='inherit'; });
  resultEl.style.display='none';
  document.getElementById('afterActions').style.display='none';
  answersEl.style.display='none';
  // reset timer
  if(timerId) clearInterval(timerId);
  secondsLeft = TOTAL_SECONDS;
  updateTimerUI();
  timerId = setInterval(()=>{
    secondsLeft--;
    updateTimerUI();
    if(secondsLeft <= 0){
      clearInterval(timerId);
      autoSubmit();
    }
  }, 1000);
});

document.getElementById('checkBtn').addEventListener('click', ()=>{
  if(timerId){ clearInterval(timerId); }
  gradeNow();
});

viewResultBtn.addEventListener('click', ()=>{
  banner.style.display = 'none';
  document.getElementById('result').scrollIntoView({behavior:'smooth'});
});

function autoSubmit(){
  timeUpUI();
  // disable all option buttons
  document.querySelectorAll('.btnopt').forEach(b=>b.disabled = true);
  gradeNow(true);
}

function timeUpUI(){ banner.style.display = 'flex'; }

function gradeNow(auto=false){
  let correct = 0;
  const rows = Array.from(document.querySelectorAll('.qrow'));

  rows.forEach((row, idx)=>{
    const i = idx+1;
    const t = document.getElementById(`tick-${i}`);
    const ans = selected[i];
    const real = row.dataset.trueType;
    if(ans === real){ correct++; t.textContent='✓ ถูก'; t.style.color='var(--good)'; }
    else{
      if(ans === undefined){ t.textContent= auto ? '⏰ หมดเวลา' : '— ยังไม่เลือก'; t.style.color='var(--muted)'; }
      else{ t.textContent=`✗ ผิด (ถูก: ${TYPES[real]})`; t.style.color='var(--bad)'; }
    }
    t.classList.remove('hidden');
  });

  const total = rows.length;
  resultEl.style.display='block';
  resultEl.innerHTML = `
    <div style="font-weight:800;font-size:20px">คะแนนของคุณ:
      <span class="${correct===total?'ok':'ng'}">${correct} / ${total}</span>
    </div>
    <div class="tiny">สุ่มลำดับข้อใหม่ทุกครั้ง • เวลาเริ่มต้น: ${TOTAL_SECONDS} วิ • เวลาเหลือ: ${secondsLeft < 0 ? 0 : secondsLeft} วิ</div>
  `;

  document.getElementById('afterActions').style.display='flex';

  // Build answer list from DOM order (สุ่มแล้ว)
  const answerHtml = rows.map((row, idx)=>{
    const name = row.dataset.name;
    const type = row.dataset.trueType;
    const exp  = row.dataset.explain;
    return `<div class="a">ข้อ ${idx+1}: ${name} → <b>${TYPES[type]}</b> — ${exp}</div>`;
  }).join('');
  answersEl.innerHTML = `<h3 style="margin:6px 0 8px">เฉลยพร้อมคำอธิบาย</h3>` + answerHtml;
}
</script>
</body>
</html>
